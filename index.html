<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restaurant POS PRO</title>

<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:15px;}
.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
button{padding:10px;border:none;border-radius:8px;margin:4px;font-size:14px;cursor:pointer;}
.dark{background:#111;color:#fff;width:100%;}
.light{background:#ddd;width:100%;}
.nav{display:flex;gap:5px;margin-bottom:10px;}
.nav button{flex:1;}
.menu-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.hidden{display:none;}
input{width:100%;padding:8px;margin:5px 0;border-radius:6px;border:1px solid #ccc;}
.section-title{font-weight:bold;margin-bottom:5px;}
#paymentButtons{display:flex;flex-wrap:wrap;gap:5px;margin:10px 0;}
.pay-btn{background:#ddd;width:48%;}
.pay-btn.active{background:#4CAF50;color:white;}
.bill-list{margin-top:10px;}
.data-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;}
.data-box{background:#f9f9f9;padding:10px;border-radius:8px;font-size:13px;}
.income-box{border-left:5px solid #4CAF50;}
.expense-box{border-left:5px solid #f44336;}
.time-right{float:right;color:#777;font-size:12px;}
.bill-no{color:#2196F3;font-weight:bold;}
</style>
</head>

<body>

<div class="nav">
<button onclick="show('home')">üè†</button>
<button onclick="show('income')">üí∞</button>
<button onclick="show('expense')">üí∏</button>
<button onclick="show('data')">üìä</button>
<button onclick="resetData()">üóë</button>
</div>

<div id="home" class="card">
<h3>‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
<div>üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î: <span id="cashTotal">0</span></div>
<div>üì± ‡πÇ‡∏≠‡∏ô: <span id="transferTotal">0</span></div>
<div>üü¢üõµ Grab: <span id="grabTotal">0</span></div>
<div>üü©üõµ LINE MAN: <span id="linemanTotal">0</span></div>
<hr>
<div><strong>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°:</strong> <span id="incomeTotal">0</span></div>
<div><strong>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°:</strong> <span id="expenseTotal">0</span></div>
<div><strong>‡∏Å‡∏≥‡πÑ‡∏£:</strong> <span id="profitTotal">0</span></div>
</div>

<div id="income" class="card hidden">
<h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h3>

<div class="menu-grid">
<div>
<div class="section-title">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</div>
<button class="light" onclick="addMenu('‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡∏•‡∏≤',50)">‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡∏•‡∏≤ 50</button>
<button class="light" onclick="addMenu('‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡πà‡∏≤',50)">‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡πà‡∏≤ 50</button>
<button class="light" onclick="addMenu('‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ú‡∏™‡∏°',50)">‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ú‡∏™‡∏° 50</button>
<button class="light" onclick="addMenu('‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡∏π',70)">‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡∏π 70</button>
</div>
<div>
<div class="section-title">Add On</div>
<button class="light" onclick="addMenu('‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô',10)">‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô 10</button>
<button class="light" onclick="addMenu('‡πÄ‡∏ó‡πâ‡∏≤‡πÑ‡∏Å‡πà',20)">‡πÄ‡∏ó‡πâ‡∏≤‡πÑ‡∏Å‡πà 20</button>
<button class="light" onclick="addMenu('‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô+‡πÄ‡∏ó‡πâ‡∏≤‡πÑ‡∏Å‡πà',20)">‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô+‡πÄ‡∏ó‡πâ‡∏≤‡πÑ‡∏Å‡πà 20</button>
<button class="light" onclick="addMenu('‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô',10)">‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô 10</button>
<button class="light" onclick="addMenu('‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏°',10)">‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏° 10</button>
</div>
</div>

<div id="paymentButtons">
<button class="pay-btn active" onclick="selectPayment('‡∏™‡∏î',this)">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
<button class="pay-btn" onclick="selectPayment('‡πÇ‡∏≠‡∏ô',this)">‡πÇ‡∏≠‡∏ô</button>
<button class="pay-btn" onclick="selectPayment('Grab',this)">Grab</button>
<button class="pay-btn" onclick="selectPayment('LINE MAN',this)">LINE MAN</button>
</div>

<div class="bill-list">
<h4>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ö‡∏¥‡∏•</h4>
<div id="billList">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
<div><strong>‡∏£‡∏ß‡∏°: <span id="billTotal">0</span> ‡∏ö‡∏≤‡∏ó</strong></div>
</div>

<button onclick="clearBill()">‡∏•‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•</button>
<button class="dark" onclick="saveIncome()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</button>
</div>

<div id="expense" class="card hidden">
<h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
<input type="text" id="expenseNote" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
<input type="number" id="expenseAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
<button class="dark" onclick="saveExpense()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</button>
</div>

<div id="data" class="card hidden">
<h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h3>
<button class="dark" onclick="exportExcel()">üì§ ‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå Excel</button>
<div id="allData"></div>
</div>

<script>
function today(){return new Date().toISOString().split("T")[0];}
function nowTime(){return new Date().toLocaleTimeString();}
var db=JSON.parse(localStorage.getItem("restaurantDB"))||{};
var currentBill=[];
var selectedPayment="‡∏™‡∏î";

/* ===== ‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•‡∏£‡∏µ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ===== */
function getNextBillNo(date){
if(!db[date] || !db[date].income) return 1;
return db[date].income.length + 1;
}

/* ===== ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ï‡∏≠‡∏ô‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô ===== */
function autoRefreshAtMidnight(){
var now=new Date();
var tomorrow=new Date();
tomorrow.setDate(now.getDate()+1);
tomorrow.setHours(0,0,0,0);
var ms=tomorrow-now;
setTimeout(function(){ location.reload(); },ms);
}
autoRefreshAtMidnight();

function selectPayment(type,btn){
selectedPayment=type;
var btns=document.querySelectorAll(".pay-btn");
for(var i=0;i<btns.length;i++){ btns[i].classList.remove("active"); }
btn.classList.add("active");
}

function show(p){
var pages=["home","income","expense","data"];
for(var i=0;i<pages.length;i++){
document.getElementById(pages[i]).classList.add("hidden");
}
document.getElementById(p).classList.remove("hidden");
updateDashboard();
renderAllData();
}

function addMenu(name,price){
currentBill.push({name:name,price:price});
renderBill();
}

function renderBill(){
if(currentBill.length===0){
document.getElementById("billList").innerHTML="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£";
document.getElementById("billTotal").innerText=0;
return;
}
var total=0,html="";
for(var i=0;i<currentBill.length;i++){
total+=currentBill[i].price;
html+=currentBill[i].name+" - "+currentBill[i].price+" ‡∏ö‡∏≤‡∏ó<br>";
}
document.getElementById("billList").innerHTML=html;
document.getElementById("billTotal").innerText=total;
}

function clearBill(){
currentBill=[];
renderBill();
}

function saveIncome(){
if(currentBill.length===0)return;
var t=today();
if(!db[t])db[t]={income:[],expense:[]};

var total=0;
for(var i=0;i<currentBill.length;i++){ total+=currentBill[i].price; }

var itemsToSave=[];
for(var j=0;j<currentBill.length;j++){
itemsToSave.push({name:currentBill[j].name,price:currentBill[j].price});
}

var billNo=getNextBillNo(t);

db[t].income.unshift({
billNo: billNo,
items: itemsToSave,
total: total,
payment: selectedPayment,
time: nowTime()
});

currentBill=[];
renderBill();
saveDB();
updateDashboard();
renderAllData();
}

/* ===== ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• + ‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏• ===== */
function renderAllData(){
var html='<div class="data-grid">';
var dates=Object.keys(db).sort().reverse();

for(var d=0; d<dates.length; d++){
var date=dates[d];

html+="<div><h4>"+date+"</h4>";

var incomes=db[date].income || [];
for(var i=0;i<incomes.length;i++){
var b=incomes[i];
var billDisplay=b.billNo || (incomes.length-i);
var itemList="";

if(b.items){
for(var x=0;x<b.items.length;x++){
itemList+="- "+b.items[x].name+" "+b.items[x].price+" ‡∏ö‡∏≤‡∏ó<br>";
}
}

html+='<div class="data-box income-box"><strong>';
html+='<span class="bill-no">‡∏ö‡∏¥‡∏• #'+billDisplay+'</span> ';
html+='‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ('+b.payment+') '+b.total+' ‡∏ö‡∏≤‡∏ó';
html+='<span class="time-right">'+b.time+'</span>';
html+='</strong><br>'+itemList+'</div>';
}
html+='</div>';

html+="<div><h4>"+date+"</h4>";
var expenses=db[date].expense || [];
for(var e=0;e<expenses.length;e++){
var ex=expenses[e];
html+='<div class="data-box expense-box"><strong>';
html+='‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ '+ex.amount+' ‡∏ö‡∏≤‡∏ó';
html+='<span class="time-right">'+ex.time+'</span>';
html+='</strong><br>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: '+(ex.note||"-")+'</div>';
}
html+='</div>';
}

html+='</div>';
document.getElementById("allData").innerHTML=html;
}

/* ===== ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏°‡∏ô‡∏π ===== */
function exportExcel(){

var csv="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏•‡∏≤,‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•,‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó,‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£,‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°\n";
var dates=Object.keys(db);

for(var i=0;i<dates.length;i++){
var date=dates[i];

var incomes=db[date].income||[];
for(var j=0;j<incomes.length;j++){
var b=incomes[j];

var itemText="";
if(b.items){
for(var x=0;x<b.items.length;x++){
itemText+=b.items[x].name+"("+b.items[x].price+") ";
}
}

/* ‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô+‡πÄ‡∏ß‡∏•‡∏≤ */
var dateTime=date+" "+b.time;

/* ‡πÉ‡∏ä‡πâ ="" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö Excel ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
csv+="=\""+dateTime+"\","
+"=\""+(b.billNo||"-")+"\","
+"=\""+b.payment+"\","
+"=\""+itemText+"\","
+"=\""+b.total+"\"\n";
}

var expenses=db[date].expense||[];
for(var e=0;e<expenses.length;e++){
var ex=expenses[e];

var dateTime2=date+" "+ex.time;

csv+="=\""+dateTime2+"\","
+"=\"-\","
+"=\"‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢\","
+"=\""+(ex.note||"-")+"\","
+"=\""+ex.amount+"\"\n";
}
}

/* ‡πÉ‡∏™‡πà BOM */
var BOM="\uFEFF";
var blob=new Blob([BOM+csv],{type:"text/csv;charset=utf-8;"});

var link=document.createElement("a");
link.href=URL.createObjectURL(blob);
link.download="restaurant-data.csv";
link.click();
}


function saveExpense(){
var t=today();
if(!db[t])db[t]={income:[],expense:[]};
var amt=Number(document.getElementById("expenseAmount").value)||0;
var note=document.getElementById("expenseNote").value||"-";
db[t].expense.unshift({amount:amt,note:note,time:nowTime()});
document.getElementById("expenseAmount").value="";
document.getElementById("expenseNote").value="";
saveDB();
updateDashboard();
renderAllData();
}

function updateDashboard(){
var t=today();
var cash=0,transfer=0,grab=0,lineman=0;
var incomes=db[t] && db[t].income ? db[t].income : [];
for(var i=0;i<incomes.length;i++){
if(incomes[i].payment==="‡∏™‡∏î")cash+=incomes[i].total;
if(incomes[i].payment==="‡πÇ‡∏≠‡∏ô")transfer+=incomes[i].total;
if(incomes[i].payment==="Grab")grab+=incomes[i].total;
if(incomes[i].payment==="LINE MAN")lineman+=incomes[i].total;
}
var expenses=db[t] && db[t].expense ? db[t].expense : [];
var expenseTotal=0;
for(var j=0;j<expenses.length;j++){ expenseTotal+=expenses[j].amount; }

document.getElementById("cashTotal").innerText=cash;
document.getElementById("transferTotal").innerText=transfer;
document.getElementById("grabTotal").innerText=grab;
document.getElementById("linemanTotal").innerText=lineman;
document.getElementById("incomeTotal").innerText=cash+transfer+grab+lineman;
document.getElementById("expenseTotal").innerText=expenseTotal;
document.getElementById("profitTotal").innerText=(cash+transfer+grab+lineman)-expenseTotal;
}

function resetData(){
localStorage.removeItem("restaurantDB");
location.reload();
}

function saveDB(){
localStorage.setItem("restaurantDB",JSON.stringify(db));
}

updateDashboard();
renderAllData();
renderBill();
</script>

</body>
</html>
