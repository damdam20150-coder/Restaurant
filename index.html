<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restaurant POS PRO</title>

<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:15px;}
.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
button{padding:10px;border:none;border-radius:8px;margin:4px;font-size:14px;cursor:pointer;}
.dark{background:#111;color:#fff;width:100%;}
.light{background:#ddd;width:100%;}
.nav{display:flex;gap:5px;margin-bottom:10px;}
.nav button{flex:1;}
.menu-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.hidden{display:none;}
input{width:100%;padding:8px;margin:5px 0;border-radius:6px;border:1px solid #ccc;}
.section-title{font-weight:bold;margin-bottom:5px;}
#paymentButtons{display:flex;flex-wrap:wrap;gap:5px;margin:10px 0;}
.pay-btn{background:#ddd;width:48%;}
.pay-btn.active{background:#4CAF50;color:white;}
.bill-list{margin-top:10px;}
.data-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;}
.data-box{background:#f9f9f9;padding:10px;border-radius:8px;font-size:13px;}
.income-box{border-left:5px solid #4CAF50;}
.expense-box{border-left:5px solid #f44336;}
.time-right{float:right;color:#777;font-size:12px;}
.bill-no{color:#2196F3;font-weight:bold;}
</style>
</head>

<body>

<div class="nav">
<button onclick="show('home')">üè†</button>
<button onclick="show('income')">üí∞</button>
<button onclick="show('expense')">üí∏</button>
<button onclick="show('data')">üìä</button>
<button onclick="resetData()">üóë</button>
</div>

<div id="home" class="card">
<h3>‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
<div>üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î: <span id="cashTotal">0</span></div>
<div>üì± ‡πÇ‡∏≠‡∏ô: <span id="transferTotal">0</span></div>
<div>üü¢üõµ Grab: <span id="grabTotal">0</span></div>
<div>üü©üõµ LINE MAN: <span id="linemanTotal">0</span></div>
<hr>
<div><strong>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°:</strong> <span id="incomeTotal">0</span></div>
<div><strong>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°:</strong> <span id="expenseTotal">0</span></div>
<div><strong>‡∏Å‡∏≥‡πÑ‡∏£:</strong> <span id="profitTotal">0</span></div>
</div>

<div id="income" class="card hidden">
<h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h3>

<div class="menu-grid">
<div>
<div class="section-title">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</div>
<button class="light" onclick="addMenu('‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡∏•‡∏≤',50)">‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡∏•‡∏≤ 50</button>
<button class="light" onclick="addMenu('‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡πà‡∏≤',50)">‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡πà‡∏≤ 50</button>
<button class="light" onclick="addMenu('‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ú‡∏™‡∏°',50)">‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ú‡∏™‡∏° 50</button>
<button class="light" onclick="addMenu('‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡∏π',70)">‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡∏π 70</button>
</div>
<div>
<div class="section-title">Add On</div>
<button class="light" onclick="addMenu('‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô',10)">‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô 10</button>
<button class="light" onclick="addMenu('‡πÄ‡∏ó‡πâ‡∏≤‡πÑ‡∏Å‡πà',20)">‡πÄ‡∏ó‡πâ‡∏≤‡πÑ‡∏Å‡πà 20</button>
<button class="light" onclick="addMenu('‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô+‡πÄ‡∏ó‡πâ‡∏≤‡πÑ‡∏Å‡πà',20)">‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô+‡πÄ‡∏ó‡πâ‡∏≤‡πÑ‡∏Å‡πà 20</button>
<button class="light" onclick="addMenu('‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô',10)">‡∏Ç‡∏ô‡∏°‡∏à‡∏µ‡∏ô 10</button>
<button class="light" onclick="addMenu('‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏°',10)">‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏° 10</button>
</div>
</div>

<div id="paymentButtons">
<button class="pay-btn active" onclick="selectPayment('‡∏™‡∏î',this)">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
<button class="pay-btn" onclick="selectPayment('‡πÇ‡∏≠‡∏ô',this)">‡πÇ‡∏≠‡∏ô</button>
<button class="pay-btn" onclick="selectPayment('Grab',this)">Grab</button>
<button class="pay-btn" onclick="selectPayment('LINE MAN',this)">LINE MAN</button>
</div>

<div class="bill-list">
<h4>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ö‡∏¥‡∏•</h4>
<div id="billList">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
<div><strong>‡∏£‡∏ß‡∏°: <span id="billTotal">0</span> ‡∏ö‡∏≤‡∏ó</strong></div>
</div>

<button onclick="clearBill()">‡∏•‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•</button>
<button class="dark" onclick="saveIncome()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</button>
</div>

<div id="expense" class="card hidden">
<h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
<input type="text" id="expenseNote" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
<input type="number" id="expenseAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
<button class="dark" onclick="saveExpense()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</button>
</div>

<div id="data" class="card hidden">
<h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h3>

<!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå -->
<button class="dark" onclick="exportExcel()">üì§ ‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå Excel</button>

<div id="allData"></div>
</div>

<script>
function today(){return new Date().toISOString().split("T")[0];}
function nowTime(){return new Date().toLocaleTimeString();}
let db=JSON.parse(localStorage.getItem("restaurantDB"))||{};
let currentBill=[];
let selectedPayment="‡∏™‡∏î";

/* ===== ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ï‡∏≠‡∏ô‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô ===== */
function autoRefreshAtMidnight(){
let now=new Date();
let tomorrow=new Date();
tomorrow.setDate(now.getDate()+1);
tomorrow.setHours(0,0,0,0);
let ms=tomorrow-now;
setTimeout(function(){
location.reload();
},ms);
}
autoRefreshAtMidnight();

/* ===== ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•‡∏£‡∏µ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ===== */
function getNextBillNo(date){
if(!db[date] || !db[date].income) return 1;
return db[date].income.length + 1;
}

function selectPayment(type,btn){
selectedPayment=type;
document.querySelectorAll(".pay-btn").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
}

function show(p){
["home","income","expense","data"].forEach(id=>{
document.getElementById(id).classList.add("hidden");
});
document.getElementById(p).classList.remove("hidden");
updateDashboard();
renderAllData();
}

function addMenu(name,price){
currentBill.push({name,price});
renderBill();
}

function renderBill(){
if(currentBill.length===0){
document.getElementById("billList").innerHTML="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£";
document.getElementById("billTotal").innerText=0;
return;
}
let total=0,html="";
currentBill.forEach((i,index)=>{
total+=i.price;
html+=`${i.name} - ${i.price} ‡∏ö‡∏≤‡∏ó 
<button onclick="removeItem(${index})">‚ùå</button><br>`;
});
document.getElementById("billList").innerHTML=html;
document.getElementById("billTotal").innerText=total;
}

function removeItem(i){
currentBill.splice(i,1);
renderBill();
}

function clearBill(){
currentBill=[];
renderBill();
}

function saveIncome(){
if(currentBill.length===0)return;
let t=today();
if(!db[t])db[t]={income:[],expense:[]};
let total=currentBill.reduce((a,b)=>a+b.price,0);
let itemsToSave=currentBill.map(i=>({name:i.name,price:i.price}));
let billNo=getNextBillNo(t);
db[t].income.unshift({
billNo: billNo,
items: itemsToSave,
total: total,
payment: selectedPayment,
time: nowTime()
});
currentBill=[];
renderBill();
saveDB();
updateDashboard();
renderAllData();
}

function renderAllData(){
let html='<div class="data-grid">';
let dates=Object.keys(db).sort().reverse();
dates.forEach(date=>{
html+=`<div><h4>${date}</h4>`;
(db[date].income||[]).forEach(b=>{
let itemList="";
if(b.items){
b.items.forEach(i=>{
itemList+=`- ${i.name} ${i.price} ‡∏ö‡∏≤‡∏ó<br>`;
});
}
html+=`
<div class="data-box income-box">
<strong>
<span class="bill-no">‡∏ö‡∏¥‡∏• #${b.billNo || "-"}</span>
‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (${b.payment}) ${b.total} ‡∏ö‡∏≤‡∏ó
<span class="time-right">${b.time}</span>
</strong><br>
${itemList}
</div>`;
});
html+='</div>';

html+=`<div><h4>${date}</h4>`;
(db[date].expense||[]).forEach(e=>{
html+=`
<div class="data-box expense-box">
<strong>
‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ${e.amount} ‡∏ö‡∏≤‡∏ó
<span class="time-right">${e.time}</span>
</strong><br>
‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${e.note || "-"}
</div>`;
});
html+='</div>';
});
html+='</div>';
document.getElementById("allData").innerHTML=html;
}

/* ===== ‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå Excel ===== */
function exportExcel(){
let csv="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡πÄ‡∏•‡∏Ç‡∏ö‡∏¥‡∏•,‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó,‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô,‡πÄ‡∏ß‡∏•‡∏≤\n";
Object.keys(db).forEach(date=>{
(db[date].income||[]).forEach(b=>{
csv+=`${date},${b.billNo},${b.payment},${b.total},${b.time}\n`;
});
(db[date].expense||[]).forEach(e=>{
csv+=`${date},-,‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢,${e.amount},${e.time}\n`;
});
});
let blob=new Blob([csv],{type:"text/csv"});
let link=document.createElement("a");
link.href=URL.createObjectURL(blob);
link.download="restaurant-data.csv";
link.click();
}

function saveExpense(){
let t=today();
if(!db[t])db[t]={income:[],expense:[]};
let amt=Number(document.getElementById("expenseAmount").value)||0;
let note=document.getElementById("expenseNote").value||"-";
db[t].expense.unshift({amount:amt,note,time:nowTime()});
document.getElementById("expenseAmount").value="";
document.getElementById("expenseNote").value="";
saveDB();
updateDashboard();
renderAllData();
}

function updateDashboard(){
let t=today();
let cash=0,transfer=0,grab=0,lineman=0;
(db[t]?.income||[]).forEach(b=>{
if(b.payment==="‡∏™‡∏î")cash+=b.total;
if(b.payment==="‡πÇ‡∏≠‡∏ô")transfer+=b.total;
if(b.payment==="Grab")grab+=b.total;
if(b.payment==="LINE MAN")lineman+=b.total;
});
let income=cash+transfer+grab+lineman;
let expense=(db[t]?.expense||[]).reduce((a,b)=>a+b.amount,0);
document.getElementById("cashTotal").innerText=cash;
document.getElementById("transferTotal").innerText=transfer;
document.getElementById("grabTotal").innerText=grab;
document.getElementById("linemanTotal").innerText=lineman;
document.getElementById("incomeTotal").innerText=income;
document.getElementById("expenseTotal").innerText=expense;
document.getElementById("profitTotal").innerText=income-expense;
}

function resetData(){
localStorage.removeItem("restaurantDB");
location.reload();
}

function saveDB(){
localStorage.setItem("restaurantDB",JSON.stringify(db));
}

updateDashboard();
renderAllData();
renderBill();
</script>

</body>
</html>
